language: bash
services: docker
sudo: required

env:
  - HADOOP_VERSION=3.2.0 SHORT_TAG=3 LATEST=true
  - HADOOP_VERSION=2.9.2 SHORT_TAG=2

script:
  - bash build.sh
  - docker run --rm --name hadoop -d crs4/hadoop:${HADOOP_VERSION}
  - "docker exec hadoop bash -c 'until datanode_cid; do sleep 0.1; done'"
  - docker cp test/check.sh hadoop:/
  - docker exec hadoop bash /check.sh
  - docker stop hadoop
  - bash test/check_custom_conf.sh

deploy:
  - provider: script
    script: bash push.sh
    on:
      repo: crs4/hadoop-docker
      branch: master
